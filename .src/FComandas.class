' Gambas class file

Public $idCategoriaTemp As Integer
Private hConn As Connection
Private hResult As Result
Private qString As String
Private tmpOrden_prods_precio As Result


Public Sub Button7_Click()

  Me.Close

End

Public Sub Form_Open()

  Dim myControl As Control
  Dim myButtons As Button
  
  'Pone el reloj a tiempo
  lblTimer.Text = modUtils.TimerClk_Timer()
  lblInfo.Text = "Orden: " & modVariables.$intOrdenTmp & ", Mesa: " & modVariables.$strMesaTemp
  
  'define the gridview layout
  gridComanda.header = GridView.Horizontal
  gridComanda.grid = True
  gridComanda.Rows.count = 0
  gridComanda.Columns.count = 4
  gridComanda.Columns[0].text = "Orden"
  gridComanda.Columns[1].text = "Producto"
  gridComanda.Columns[2].text = "Cantidad"
  gridComanda.Columns[3].text = "Precio"
  
  gridComanda.Columns[0].width = 55
  gridComanda.Columns[1].width = 155
  gridComanda.Columns[2].width = 55
  gridComanda.Columns[3].width = 55
  
  Try hConn = modConn.ConectarDB()
  If Error Then Print Error.Text
  
  qString = "Select * from tbl_categorias order by fl_orden"
  
  Try hResult = hConn.Exec(qString)
  If Error Then Print Error.Text
  
  If hResult.Available Then
    For Each hResult
      myButtons = New Button(Me) As "KeyButton"
      myButtons.Font.Size = 11
      myButtons.Picture = Button1.Picture
      myButtons.Text = hResult!chr_nombre_cat
      myButtons.Tag = hResult!id_categoria
      myButtons.ToolTip = hResult!chr_desc_cat
      myButtons.Reparent(boxCategorias)
      myButtons.Expand = True 
    Next
    
    Button1.Visible = False
  Endif
  
  hConn.Close
  hConn = Null

End

Public Sub KeyButton_Click()
  'Message.Info("Button Tag: " & Last.Tag & "\nButton Text: " & Last.Text)
  
  
  $idCategoriaTemp = Last.Tag
  FsAMProds.ShowModal()
  
  If (modVariables.$FsAMProdsReturn = True) Then
    
    hConn = modConn.ConectarDB()
    
    qString = "SELECT * FROM vw_orden_prods_precio where Orden = &1"  
    Try tmpOrden_prods_precio = hConn.Exec(qString, modVariables.$intOrdenTmp)
    If Error Then Message.Error(Error.text) Else gridComanda.Rows.Count = tmpOrden_prods_precio.Count
    
  Endif

End

Public Sub gridComanda_Data(Row As Integer, Column As Integer)

Dim tmpString As String

  tmpOrden_prods_precio.moveTo(Row)
  
  If (Column = 3) Then 
    tmpString = Str(tmpOrden_prods_precio[gridComanda.Columns[column].text])
    'gridComanda.Data.text = Format(tmpString, "($$,#.###)")
    gridComanda.Data.text = tmpString
  Else
    gridComanda.Data.text = Str(tmpOrden_prods_precio[gridComanda.Columns[column].text])  
  Endif
  
End

Public Sub Timer1_Timer()

  lblTimer.Text = modUtils.TimerClk_Timer()

End

