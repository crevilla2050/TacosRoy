' Gambas class file

Static Public User As String
Static Public Password As String

Private sQuery As String
Private rResult As Result

'Private $sUrl As String
'Private $sRealm As String

Public Sub Run(sUrl As String, sRealm As String) As Boolean

  lblRealm.Text = "Por favor introduzca sus credenciales"
  Me.Title = "Validación de usuario"
  '$sUrl = sUrl
  '$sRealm = sRealm
  Return Not Me.ShowModal()

End

Public Sub btnOK_Click()

  User = txtUser.Text
  Password = txtPassword.Text
  
  sQuery = "SELECT * FROM tbl_usuarios where chr_login = '" & User & "' and chr_password = '" & Crypt.MD5(Password, "tacosroy") & "'"
  Try rResult = modVariables.$hConn.Exec(sQuery)
  
  If rResult.Available Then
    modVariables.$usrAutorizado = True
    modVariables.$usuarioConectado = rResult[0]
    FMain1.Show
    Me.Close(True)
  Else
    Message.Error("Usuario/Contraseña incorrectos")
    modVariables.$usrAutorizado = False 
    Me.Close(False)
    
  Endif

End

Public Sub btnCancel_Click()
  
  modVariables.$usrAutorizado = False 
  Me.Close(False)

End


Public Sub Form_Open()

  modVariables.$hConn = modConn.ConectarDB()
  If modVariables.$hConn = Null Then Message.Error("No se pudo conectar a la base de datos") Else txtUser.SetFocus

End
