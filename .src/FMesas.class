' Gambas class file

Private hResult As Result
Private hConn As Connection

Public Sub Form_Open()

  Dim myButtons As Button
  Dim tmpString As String
  Dim intCnt As Integer
    
  hConn = modConn.ConectarDB()
  
  intCnt = 1
  
  tmpString = "Select * From `tbl_mesas` where `tbl_mesas`.`bit_mesa_activa` = True order by `tbl_mesas`.`id_mesa_id` Asc"
  
  Try hResult = hConn.Exec(tmpString)
  If Error Then Print Error.Text
  
  If hResult.Available Then
    For Each hResult
      myButtons = New Button(Me) As "MesasButton"
      myButtons.Font.Size = 12
      myButtons.Text = hResult!chr_mesa
      myButtons.Tag = hResult!id_mesa_id
      myButtons.Expand = True
      'Print intCnt
      If (intCnt >= 1 And intCnt <= 6) Then myButtons.Reparent(HBox1)
      If (intCnt > 6 And intCnt <= 12) Then myButtons.Reparent(HBox2)
      If (intCnt > 12 And intCnt <= 18) Then myButtons.Reparent(HBox3)
      Inc intCnt
    Next
  Endif
  hConn.Close
End

Public Sub MesasButton_Click()
  
  modVariables.$strMesaTemp = Last.Tag

  Print Last.Tag
  
  BtnMesaOK.Enabled = True
  btnMesaCancel.Enabled = True
  
End

Public Sub btnMesaCancel_Click()

  If (Message.Question("Deseas CANCELAR la operación?", "Sí, cancelar", "No, continuar") = 1) Then
    modVariables.$strMesaTemp = 0
    Me.Close
    Return
  Endif

End

Public Sub BtnMesaOK_Click()

  Message("Mesa asignada:" & modVariables.$strMesaTemp)
  Me.Close

End

Public Sub Form_Close()

  If modVariables.$strMesaTemp = "" Then 
    Message.Error("No se ha elegido mesa, se asignará PARA LLEVAR")
    modVariables.$strMesaTemp = 16
  Endif

End
