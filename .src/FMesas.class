' Gambas class file

Private hResult As Result
Private hConn As Connection

Public Sub Form_Open()

  Dim myButtons As Button
  Dim sQuery As String
  Dim intCnt As Integer
    
  intCnt = 1
  modVariables.$intMesero = 0
  sQuery = "Select * From `tbl_mesas` where `tbl_mesas`.`bit_mesa_activa` = True order by `tbl_mesas`.`id_mesa_id` Asc"
  
  Try hResult = modVariables.$hConn.Exec(sQuery)
  If Error Then Print Error.Text
  
  If hResult.Available Then
    For Each hResult
      myButtons = New Button(Me) As "MesasButton"
      myButtons.Font.Size = 12
      myButtons.Text = hResult!chr_mesa
      myButtons.Tag = hResult!id_mesa_id
      myButtons.Expand = True
      'Print intCnt
      If (intCnt >= 1 And intCnt <= 6) Then myButtons.Reparent(HBox1)
      If (intCnt > 6 And intCnt <= 12) Then myButtons.Reparent(HBox2)
      If (intCnt > 12 And intCnt <= 18) Then myButtons.Reparent(HBox3)
      Inc intCnt
    Next
  Endif
  hResult = Null
  sQuery = "SELECT * FROM tbl_personal where bit_activo = 1 order by id_personal Asc"
  Try hResult = modVariables.$hConn.Exec(sQuery)
  
  For Each hResult
    cmbMeseros.Add(hResult!chr_nombre_persona, hResult!id_personal)
  Next

Catch
  Message.error(Error.Text & ", " & Error.Where)  
  Print Error.Text & ", " & Error.Where
  hResult = Null
End

Public Sub MesasButton_Click()
  
  modVariables.$strMesaTemp = Last.Tag

'  Print Last.Tag
  
  BtnMesaOK.Enabled = True
  btnMesaCancel.Enabled = True
  
End

Public Sub btnMesaCancel_Click()

  If (Message.Question("Deseas CANCELAR la operación?", "Sí, cancelar", "No, continuar") = 1) Then
    modVariables.$strMesaTemp = 0
    Me.Close
    Return
  Endif

End

Public Sub BtnMesaOK_Click()

modVariables.$intMesero = cmbMeseros.Index + 1
If modVariables.$strMesaTemp <> "" And modVariables.$intMesero <> 0 Then 
  Message("Mesa asignada:" & modVariables.$strMesaTemp & "\nMesero: " & cmbMeseros.Text)
  Me.Close
Else
  Message.Error("¡No se ha asignado una mesa, o falta asignar mesero!")
Endif

End


