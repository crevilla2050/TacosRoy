' Gambas class file




Public Sub Form_Open()
  
  modVariables.sPrefijoDB = "casa"
  modVariables.c_Conn = modConn.ConectarDB()
  
  End
Private Sub holder()
  
  '      Select Case hResult["ID TPago"]
'        Case 1
'          
'          Else
'            If hResult["Activo"] = 1 Then 
'              flEfectivo += flTemporal 
'            Else 
'              flBorradoV += flTemporal
'            Endif
'            sDetallado &= "x " & iCantidad & "</td><td align=\"right\" " & sDelString & ">(" & hResult["CHRTipoPrecio"] & ") - $" & CStr(flTemporal) & "</td></tr/>" 
'          Endif
'        Case 2
'          sDetallado &= "<tr><td colspan=\"2\" " & sDelString & ">" & hResult["Producto"] & "*</td></tr><tr><td align = \"left\" " & sDelString & ">"
'          If hResult["Activo"] = 1 Then 
'            flDescuento += flTemporal 
'          Else 
'            flBorradoV += flTemporal
'          Endif
'          sDetallado &= "x " & iCantidad & "</td><td align=\"right\" " & sDelString & ">(" & hResult["Tipo Pago"] & ") - $" & CStr(flTemporal) & "</td></tr/>" 
'        Case 3
'          sDetallado &= "<tr><td colspan=\"2\" " & sDelString & ">" & hResult["Producto"] & "</td></tr><tr><td align = \"left\" " & sDelString & ">"
'          If hResult["Tipo Precio"] = iIndexPersonal Then
'            hResultEmpleado = Null
'            sQuery = "SELECT * FROM `tbl_precios_productos` where `id_producto` = &1 and int_tipo_precio = 1 and bit_activo = 1;"
'            Try hResultEmpleado = modVariables.c_Conn.Exec(sQuery, hResult["ID Prod"])
'            If (hResultEmpleado <> Null) And hResultEmpleado.Available Then 
'              flTemporal = CFloat(hResultEmpleado["dbl_precio"]) * CFloat(hResult["Cantidad"]) 
'              If hResult["Activo"] = 1 Then 
'                flEmpleados += flTemporal
'              Else 
'                flBorradoE += flTemporal
'              Endif
'            Else
'              flEmpleados += 0
'            Endif
'            'sTemporal &= "x " & iCantidad & "</td><td align=\"right\">(" & hResult["CHRTipoPrecio"] & ") - $" & flEmpleados & "</td></tr/>" 
'          Else
'            If hResult["Activo"] = 1 Then 
'              flEmpleados += flTemporal
'            Else 
'              flBorradoE += flTemporal
'            Endif
'          Endif
'          sDetallado &= "x " & iCantidad & "</td><td align=\"right\" " & sDelString & ">(" & hResult["CHRTipoPrecio"] & ") - $" & CStr(flTemporal) & "</td></tr/>" 
'          hResultEmpleado = Null
'        Case 4
'          sDetallado &= "<tr><td colspan=\"2\" " & sDelString & ">" & hResult["Producto"] & "</td></tr><tr><td align = \"left\" " & sDelString & ">"
'          If hResult["Activo"] = 1 Then 
'            flTarjeta += flTemporal
'          Else 
'            flBorradoV += flTemporal
'          Endif
'          sDetallado &= "x " & iCantidad & "</td><td align=\"right\" " & sDelString & ">(" & hResult["CHRTipoPrecio"] & ") - $" & CStr(flTemporal) & "</td></tr/>" 
'      End Select
  
End



Public Sub Button1_Click()

  Dim sQuery As String
  Dim rResult As Result
  Dim rResultTemp As Result
  Dim rResultOper As Result
  Dim iInc As Integer

  sQuery = "SELECT * FROM  tbl_prods_variantes where int_activo = 1 order by id_prods_variantes, id_producto, id_variante;"
  rResult = modVariables.c_Conn.Exec(sQuery)
  
  For Each rResult
      
    sQuery = "SELECT * FROM `tbl_costos_extra_var_prod` where `id_producto_variante` = &1;"
    Try rResultTemp = modVariables.c_Conn.Exec(sQuery, rResult["id_prods_variantes"])
    
    If rResultTemp.Available Then
      For iInc As Integer = 1 To 2
        For Each rResultTemp
          rResultOper = Null
            Select Case rResult["id_variante"]
              Case 10
                sQuery = "`id_producto_variante` = &1 and `id_tipo_precio` = &2"
                rResultOper = modVariables.c_Conn.Edit("tbl_costos_extra_var_prod", sQuery, rResult["id_prods_variantes"], iInc)
                modVariables.c_Conn.Begin()
                rResultOper!fl_costo_extra = 5
                rResultOper.Update()
                modVariables.c_Conn.Commit()
              Case 17
                sQuery = "`id_producto_variante` = &1 and `id_tipo_precio` = &2"
                rResultOper = modVariables.c_Conn.Edit("tbl_costos_extra_var_prod", sQuery, rResult["id_prods_variantes"], iInc)
                modVariables.c_Conn.Begin()
                rResultOper!fl_costo_extra = 5
                rResultOper.Update()
                modVariables.c_Conn.Commit()
              Case 19
                sQuery = "`id_producto_variante` = &1 and `id_tipo_precio` = &2"
                rResultOper = modVariables.c_Conn.Edit("tbl_costos_extra_var_prod", sQuery, rResult["id_prods_variantes"], iInc)
                modVariables.c_Conn.Begin()
                rResultOper!fl_costo_extra = 10
                rResultOper.Update()
                modVariables.c_Conn.Commit()
              Default
                Print rResult["id_prods_variantes"] & ", " & rResult[2]
            End Select
          rResultOper = Null
        Next
        'Inc iInc
      Next
    Else
      rResultOper = Null
      For iInc As Integer = 1 To 2
        
        Select Case rResult["id_variante"]
          Case 10
            modVariables.c_Conn.Begin()
            rResultOper = modVariables.c_Conn.Create("tbl_costos_extra_var_prod")
            rResultOper!id_producto_variante = rResult[0]
            rResultOper!id_fecha_control = 18
            rResultOper!fl_costo_extra = 5
            rResultOper!id_tipo_precio = iInc
            rResultOper.Update()
          modVariables.c_Conn.Commit()
          Case 17
            modVariables.c_Conn.Begin()
            rResultOper = modVariables.c_Conn.Create("tbl_costos_extra_var_prod")
            rResultOper!id_producto_variante = rResult[0]
            rResultOper!id_fecha_control = 18
            rResultOper!fl_costo_extra = 5
            rResultOper!id_tipo_precio = iInc
            rResultOper.Update()
          modVariables.c_Conn.Commit()
          Case 19
            modVariables.c_Conn.Begin()
            rResultOper = modVariables.c_Conn.Create("tbl_costos_extra_var_prod")
            rResultOper!id_producto_variante = rResult[0]
            rResultOper!id_fecha_control = 18
            rResultOper!fl_costo_extra = 10
            rResultOper!id_tipo_precio = iInc
            rResultOper.Update()
          modVariables.c_Conn.Commit()
          Default
            Print rResult["id_prods_variantes"] & ", " & rResult[2]
        End Select
          
        'Inc iInc
      Next
    Endif
  Next

End

Public Sub Button2_Click()

Dim sQuery As String
Dim rResultProds, rResultProdVar As Result
Dim rResultOper, rResultTemp As Result
Dim iInc As Integer

  sQuery = "SELECT * FROM `tbl_productos` where `id_categoria` = &1 and `int_activo` = 1 order by `id_categoria`, `id_producto`;"
  rResultProds = modVariables.c_Conn.Exec(sQuery, TextBox1.Text)
  
  For Each rResultProds
    sQuery = "SELECT * FROM `tbl_prods_variantes` where `id_producto` = &1"
    rResultProdVar = modVariables.c_Conn.Exec(sQuery, rResultProds["id_producto"])
    If rResultProdVar.Available Then
      For Each rResultProdVar
        rResultTemp = ""
        
        For iInc As Integer = 1 To 2
          Select Case rResultProdVar["id_variante"]
            Case 10 'Para llevar
              sQuery = " `id_producto_variante` = &1 and `id_tipo_precio` = &2 "
              rResultOper = modVariables.c_Conn.Edit("tbl_costos_extra_var_prod", sQuery, rResultProdVar["id_prods_variantes"], iInc)
              modVariables.c_Conn.Begin()
              'rResultOper!id_producto_variante = rResultProdVar[0]
              rResultOper!id_fecha_control = 18
              rResultOper!fl_costo_extra = textBox2.Text
              rResultOper!id_tipo_precio = iInc
              rResultOper.Update()
            modVariables.c_Conn.Commit()
            Case 17 'A domicilio
              sQuery = " `id_producto_variante` = &1 and `id_tipo_precio` = &2 "
              rResultOper = modVariables.c_Conn.Edit("tbl_costos_extra_var_prod", sQuery, rResultProdVar["id_prods_variantes"], iInc)
              modVariables.c_Conn.Begin()
              'rResultOper!id_producto_variante = rResultProdVar[0]
              rResultOper!id_fecha_control = 18
              rResultOper!fl_costo_extra = textBox3.Text
              rResultOper!id_tipo_precio = iInc
              rResultOper.Update()
            modVariables.c_Conn.Commit()
            Case 19 'Tortilla de Harina
              sQuery = "`id_producto_variante` = &1 and `id_tipo_precio` = &2"
              rResultOper = modVariables.c_Conn.Edit("tbl_costos_extra_var_prod", sQuery, rResultProdVar["id_prods_variantes"], iInc)
              modVariables.c_Conn.Begin()
              'rResultOper!id_producto_variante = rResultProdVar[0]
              rResultOper!id_fecha_control = 18
              rResultOper!fl_costo_extra = textBox4.Text
              rResultOper!id_tipo_precio = iInc
              rResultOper.Update()
            modVariables.c_Conn.Commit()
            Default
              Print rResultProdVar["id_prods_variantes"] & ", " & rResultProdVar[2]
          End Select
        Next
      Next  
      rResultProdVar = Null
        'sQuery = "SELECT * FROM  tbl_costos_extra_var_prod where `id_producto_variante` = &1;"
        'rResultTemp = modVariables.c_Conn.Exec(sQuery, rResultProdVar["id_producto_variante"])
    Endif
    
    
'    modVariables.c_Conn.Begin()
'      rResultTemp = modVariables.c_Conn.Create("tbl_precios_productos")
'      rResultTemp!id_producto = rResultProdVar["id_producto"]
'      rResultTemp!dbl_precio = 0
'      rResultTemp!int_tipo_precio = 3
'      rResultTemp!bit_activo = 1
'      rResultTemp!dat_fecha_precio_activo = Now()
'      rResultTemp.Update()
'    modVariables.c_Conn.Commit()
  Next
  

End

Public Sub Button3_Click()

  Dim iInc, iNumber As Integer
  Dim rResultOper As Result
  Dim sQuery As String
  
   'sQuery = " `id_consecutivo` = &1 "
   sQuery = " `id_ticketNrConsecutivo` = &1 "
   
   iNumber = 3196
   Inc Application.Busy
    For iInc = 7077 To 7658
      'rResultOper = modVariables.c_Conn.Edit("tbl_consecutivo", sQuery, iInc)
      '  modVariables.c_Conn.Begin()
      '  rResultOper!chr_consecutivo = iNumber
      '  rResultOper.Update()
      
      rResultOper = modVariables.c_Conn.Edit("tbl_ticket_cons", sQuery, iInc)
        modVariables.c_Conn.Begin()
        rResultOper!chr_ticketConsecutivo = iNumber
        rResultOper.Update()
      
      modVariables.c_Conn.Commit()
      Inc iNumber
    Next
    Dec Application.Busy

End

Public Sub Button4_Click()

Dim sQuery As String
Dim hResult1, rResultTemp As Result

  sQuery = "SELECT * FROM `tbl_productos` where `int_activo` = 1 order by `id_producto`"

  Try hResult1 = modVariables.c_Conn.Exec(sQuery)

  For Each hResult1
    
    sQuery = "`id_producto` = &1"
    modVariables.c_Conn.Begin()
      rResultTemp = modVariables.c_Conn.Edit("tbl_productos", sQuery, hResult1["id_producto"])
    
      If (hResult1["id_grupo_producto"] = Null) Then 
        rResultTemp!id_grupo_def = 5
      Else 
        rResultTemp!id_grupo_def = hResult1["id_grupo_producto"]
      Endif
    
      rResultTemp.Update()
    modVariables.c_Conn.Commit()
    
  Next

End

Public Sub Button5_Click()

Dim sQuery As String
Dim hResult As Result
Dim sHTML As String

  sQuery = "SELECT * FROM db_tacosroy_trujano.vw_prods_x_orden where Activo = 0 and `Control Fecha` >= 444"
  Try hResult = modVariables.c_Conn.Exec(sQuery)
  
  sHTML = modUtils.exportHTMLFile(hResult)
  
  Dialog.Filter = ["*.xls", "Hoja de Cálculo Excel"]
  
  If Dialog.SaveFile() Then Return
  If Right(Dialog.Path, 4) <> ".xls" Then Dialog.Path &= ".xls"
  File.Save(Dialog.Path, sHTML)

End




